# ğŸš€ Backend Deployment Guide - Render.com

## âœ… **BACKEND READY FOR DEPLOYMENT**

Backend-ul a fost complet actualizat sÄƒ foloseascÄƒ Supabase PostgreSQL Ã®n loc de SQLite.

---

## ğŸ“‹ **CE A FOST ACTUALIZAT:**

### **1. Supabase Integration** âœ…
- `server/supabase.ts` - Supabase client pentru backend
- `server/auth-supabase.ts` - Serviciu autentificare complet
- `verify_password()` SQL function Ã®n Supabase
- Toate operaÈ›iunile sunt async/await

### **2. Server Updates** âœ…
- `server/index.ts` - Actualizat sÄƒ foloseascÄƒ Supabase
- Removed SQLite dependencies
- Updated login/register routes
- Added authenticateToken middleware

### **3. Environment Variables** âœ…
- `VITE_SUPABASE_URL` - Supabase project URL
- `SUPABASE_SERVICE_KEY` - Service role key (full access)
- `JWT_SECRET` - JWT signing secret
- `FRONTEND_URL` - Frontend URL pentru CORS

---

## ğŸš€ **DEPLOYMENT STEPS:**

### **Option 1: Deploy via Render Dashboard (RECOMMENDED)**

#### **Step 1: Create New Web Service**

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository: `adrianstanca1/CortexBuild`
4. Configure service:
   ```
   Name: cortexbuild-backend
   Region: Oregon (US West)
   Branch: main
   Root Directory: (leave empty)
   Runtime: Node
   Build Command: npm install
   Start Command: npm run server
   Plan: Free
   ```

#### **Step 2: Add Environment Variables**

Click "Advanced" â†’ "Add Environment Variable" and add:

```
NODE_ENV=production
PORT=5000
JWT_SECRET=<auto-generated or custom>
FRONTEND_URL=https://cortex-build-mcnrk7yba-adrian-b7e84541.vercel.app
VITE_SUPABASE_URL=https://qglvhxkgbzujglehewsa.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbHZoeGtnYnp1amdsZWhld3NhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODIzNzkwMSwiZXhwIjoyMDczODEzOTAxfQ.eg6hoz1bIc1FzPjMAs8oaCuv1yjymxk_5MYjpg9vEFQ
```

**âš ï¸ IMPORTANT:** Keep `SUPABASE_SERVICE_KEY` secret! Never commit it to Git.

#### **Step 3: Deploy**

1. Click "Create Web Service"
2. Wait for deployment (~2-3 minutes)
3. Copy the backend URL (e.g., `https://cortexbuild-backend.onrender.com`)

---

### **Option 2: Deploy via render.yaml (Automatic)**

#### **Step 1: Update render.yaml**

The `render.yaml` file is already configured. Just need to add `SUPABASE_SERVICE_KEY` manually.

#### **Step 2: Deploy from Dashboard**

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" â†’ "Blueprint"
3. Connect repository: `adrianstanca1/CortexBuild`
4. Select `render.yaml`
5. Click "Apply"

#### **Step 3: Add SUPABASE_SERVICE_KEY**

1. Go to service settings
2. Environment â†’ Add Environment Variable
3. Key: `SUPABASE_SERVICE_KEY`
4. Value: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (from `.env.local`)
5. Save

---

### **Option 3: Deploy via Render Deploy Button**

Click this button to deploy instantly:

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://api.render.com/deploy/srv-d3n6jk6r433s73avk6k0?key=vWmFnH5RZpw)

Then add `SUPABASE_SERVICE_KEY` in environment variables.

---

## ğŸ” **ENVIRONMENT VARIABLES REFERENCE:**

| Variable | Value | Required | Secret |
|----------|-------|----------|--------|
| NODE_ENV | production | âœ… | âŒ |
| PORT | 5000 | âœ… | âŒ |
| JWT_SECRET | (auto-generated) | âœ… | âœ… |
| FRONTEND_URL | https://cortex-build-mcnrk7yba-adrian-b7e84541.vercel.app | âœ… | âŒ |
| VITE_SUPABASE_URL | https://qglvhxkgbzujglehewsa.supabase.co | âœ… | âŒ |
| SUPABASE_SERVICE_KEY | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... | âœ… | âœ… |

---

## âœ… **VERIFICATION STEPS:**

### **1. Check Deployment Status**

```bash
# Check if service is live
curl https://your-backend-url.onrender.com/api/health

# Expected response:
{
  "status": "ok",
  "timestamp": "2025-10-14T..."
}
```

### **2. Test Login**

```bash
curl -X POST https://your-backend-url.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "adrian.stanca1@gmail.com",
    "password": "parola123"
  }'

# Expected response:
{
  "success": true,
  "user": {
    "id": "user-1",
    "email": "adrian.stanca1@gmail.com",
    "name": "Adrian Stanca",
    "role": "super_admin",
    ...
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### **3. Check Logs**

1. Go to Render Dashboard
2. Select your service
3. Click "Logs" tab
4. Look for:
   ```
   âœ… Supabase client initialized
   âœ… Supabase connected successfully
   âœ… Auth service (Supabase) initialized
   ğŸš€ Server running on port 5000
   ```

---

## ğŸ”„ **UPDATE FRONTEND WITH BACKEND URL:**

### **Step 1: Update Vercel Environment Variables**

```bash
# Set backend URL in Vercel
vercel env add VITE_API_URL production

# When prompted, enter:
https://your-backend-url.onrender.com
```

### **Step 2: Redeploy Frontend**

```bash
vercel --prod
```

---

## ğŸ¯ **FINAL CHECKLIST:**

- [ ] Backend deployed on Render.com
- [ ] All environment variables set
- [ ] SUPABASE_SERVICE_KEY added (secret)
- [ ] Health check returns 200 OK
- [ ] Login test successful
- [ ] Logs show no errors
- [ ] Frontend updated with backend URL
- [ ] Frontend redeployed
- [ ] End-to-end login test successful

---

## ğŸ› **TROUBLESHOOTING:**

### **Issue: "Failed to connect to Supabase"**

**Solution:**
1. Check `VITE_SUPABASE_URL` is correct
2. Check `SUPABASE_SERVICE_KEY` is correct
3. Verify Supabase project is active

### **Issue: "Invalid email or password"**

**Solution:**
1. Check passwords are encrypted with bcrypt in database
2. Verify `verify_password()` function exists in Supabase
3. Test password verification:
   ```sql
   SELECT verify_password('adrian.stanca1@gmail.com', 'parola123');
   ```

### **Issue: "CORS error"**

**Solution:**
1. Check `FRONTEND_URL` matches your Vercel URL
2. Update CORS settings in `server/index.ts` if needed

---

## ğŸ“Š **DEPLOYMENT ARCHITECTURE:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER BROWSER                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND (Vercel)                          â”‚
â”‚  https://cortex-build-mcnrk7yba-adrian-b7e84541...     â”‚
â”‚  - React 19.2.0                                         â”‚
â”‚  - Vite 6.3.6                                           â”‚
â”‚  - Supabase Client (anon key)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (Render.com)                       â”‚
â”‚  https://cortexbuild-backend.onrender.com              â”‚
â”‚  - Express.js                                           â”‚
â”‚  - JWT Authentication                                   â”‚
â”‚  - Supabase Client (service key)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Supabase)                        â”‚
â”‚  https://qglvhxkgbzujglehewsa.supabase.co              â”‚
â”‚  - PostgreSQL 17                                        â”‚
â”‚  - Row Level Security                                   â”‚
â”‚  - Real-time subscriptions                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‰ **READY TO DEPLOY!**

Backend-ul este complet pregÄƒtit pentru deployment pe Render.com!

**Next Steps:**
1. Deploy backend pe Render.com
2. CopiazÄƒ backend URL
3. ActualizeazÄƒ Vercel cu backend URL
4. TesteazÄƒ login end-to-end

**Deployment Time:** ~5 minutes  
**Status:** âœ… READY

---

**Date:** 2025-10-14  
**Backend:** Express.js + Supabase  
**Database:** PostgreSQL 17  
**Auth:** JWT + bcrypt

